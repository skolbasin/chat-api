# Корпоративный сервис микроблогов на Flask
В данном репозитории расположен сервис микроблогов, написанное на Flask с использованием PostgreSQL и развернутое через docker-compose. Все 11 endpoints покрыты unit-тестами, приложение прошло проверку линтерами и задокументировано через Swagger. В том числе в приложении добавлено логирование и Makefile для пользователей Linux

## Основные инструменты
- приложение написано на **Python 3.11** через **Flask 3.0.3**
- все зависимости расположены в **requirements.txt**
- приложение разворачивается через **docker-compose**, состоящем из 2х контейнеров(flask_app - само приложение, db - база данных PostgreSQL)
- документация оформлена через **Swagger**
- unit-тесты написаны через библиотеку **pytest**
- СУБД - **PostgreSQL**
- Работа с БД осуществляется при помощи **SQLAlchemy**
- декораторы проверяют ключ безопасности на каждом endpoint и наличие user_id в БД 
- для логирования используется библиотека **logging**
- проверка осуществлена через линтеры: **mypy, isort, black**. В случае работы с проектом на GitLab, настроена автоматизация CI через **.gitlab-ci.yml**

## Как запустить
1. Клонировать репозиторий:
```
git clone https://gitlab.skillbox.ru/sergei_kolbasin/python_advanced_diploma.git
```
2. Запустить сервер:
```
docker-compose up -d
```
Либо на Linux:
```
make run
```
P.S. Проверьте наличие Docker на вашем компьютере(docker --version)
## Структура проекта
Этот проект состоит из клиентской и серверной компонентов, каждый из которых имеет свои собственные подкаталоги и файлы.

### root/
- `client`: Директория, содержащая клиентску часть приложения
- `server`: Директория, содержащая серверную часть приложения
- `run.py`: Основная точка входа для запуска сервера
- `.gitignore`: Файл игнорирования Git
- `Makefile`: Makefile для задач проекта
- `Dockerfile`: Dockerfile для контейнеризации
- `docker-compose.yml`: Конфигурация Docker Compose
- `docker-compose-test.yml`: Конфигурация Docker Compose с БД для unit-тестирования
- `requirements.txt`: Необходимые пакеты Python
- `README`: Файл Readme проекта
- `LICENCE`: Информация о лицензировании
- `.gitlab-ci.yml`: Конфигурация CI.

## /client
Содержит код на стороне клиента
- Включает в себя следующие подкаталоги:
  - `__MACOSX`: Скрытый каталог
  - `static`: Статические файлы для клиента

## /server
Содержит код на стороне сервера
- Включает в себя следующие подкаталоги:
  - `doc`: Файлы документации
  - `src`: Исходный код
  - `tests`: Файлы тестирования
- А также файлы:
  - `db.py`: Файл с функциями, влияющими на измененние базы данных
  - `decorators.py`: Пользовательские декораторы для сервера

### /server/doc
Содержит файлы документации
- Включены следующие файлы:
  - `doc_config.py`: Конфигурационный файл для документации
  - `swagger_api.json`: Определение API Swagger
  - `swagger_doc.yml`: Документация Swagger
  - `swagger_models.yml`: Описание моделей Swagger

### /server/src
Содержит исходный код для сервера
- Включает подкаталоги для логов, конфигурации, моделей и маршрутов
  - `config.py`: Файл конфигурации
  - `log_config.py`: Файл конфигурации логов
  - `models.py`: Файл c моделями
  - `routes.py`: Файл API

### /server/tests
Содержит файлы тестов для сервера
- `conftest.py`:  Файл с фикстурами
- `test_flask.py`: Файл с тестами


## Документация(Swagger)
В самом проекте все конфигурационные файлы вынесены в отдельную директорию - *doc*. Swagger дает возможность настраивать конфигурацию документации как напрямую в python-коде, так и через YAML или JSON файлы. В проекте использована конфигурация через отдельные файлы с возможностью выбора в *doc_config.py* 2х сценариев:
- записи документации в одном файле(all_doc). Модели + API
- разделении на файл с моделями(models_doc) и файл с api(api_doc)

Если вы меняете в *doc_config.py* шаблон
```
Swagger(app, template_file=all_doc)
```
то необходимо заново пересобрать контейнер через 
```
docker-compose up -d --build
```
Либо на Linux:
```
make build
```
## Тесты
Все unit-тесты написаны при помощи библиотеки pytest. Фикстуры для подключения к БД и настройки приложения под тестирование находятся в папке conftest.py. Сами тесты расположены в файле test_flask.py

Для проверки БД на прохожение unit-тестов, необходимо переключиться на БД для тестирования. Для этого выполните команду:
```
docker-compose -f docker-compose-test.yml up
```
Либо на Linux:
```
make build-tests
```
Если вы хотите запустить все тесты разом, то выполните команду:
```
pytest server/tests/test_flask.py
```
Либо на Linux:
```
make tests
```
 
## Линтеры
Приложение прошло проверку следующих линтеров:
- black
- isort
- mypy

При внесении каких-либо изменений в проект и необходимости проверки его линтерами, достаточно вызвать следующие команды:
```
black server
isort --profile black server
mypy server
```
Либо на Linux:
```
make logging
```

## Логирование
Настройка логирования осуществляется в *src/log_config.py* с использованием библиотеки logging. Сами логи вынесены в отдельную директорию *logs* c разделением на:
- client_logs. Логи с фронта. Все они вызываются из функций, находящихся в файле /server/db.py и предназначены для отслеживания действий пользователей
- server_logs. Логи бека. В основном нацелены на проверку корректности запуска приложения на стороне сервера
